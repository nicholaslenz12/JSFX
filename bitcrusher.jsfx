/*


 */


desc: bitcrusher

// ----------------------------------------------------------------------------
// SLIDER DEFINITIONS
// ----------------------------------------------------------------------------
slider1:16<1,16,0.1>Bits
slider2:1<0.01,1,0.001>Frequency

// ----------------------------------------------------------------------------
// DEFAULT CHANNEL CONFIGURATION
// ----------------------------------------------------------------------------
in_pin:left input
in_pin:right input
out_pin:left output
out_pin:right output


// ----------------------------------------------------------------------------
// INIT
// ----------------------------------------------------------------------------
@init
cycle = 0;
l = 0;
r = 0;

// ----------------------------------------------------------------------------
// SLIDER
// ----------------------------------------------------------------------------
@slider
a = srate-1;
val = a*2^slider2+(1-a);
bits = slider1;
cycle_length = (srate/val)|0;
granularity = 1/((2^bits)|0);


// ----------------------------------------------------------------------------
// SAMPLE
// ----------------------------------------------------------------------------
@sample
cycle == 0 ?
(
l = granularity*((spl0/granularity + 0.5)|0);
r = granularity*((spl1/granularity + 0.5)|0);
);
spl0 = l;
spl1 = r;

(cycle += 1) > cycle_length ? cycle = 0;

@gfx 200 200
gfx_rect(0,0,1,1);
