// This is my second JSFX, it should distort a signal.

desc: Distortion(Test)

slider1:0<0,2,1{Type1,Type2,Type3}>Distortion Type
slider2:0<-30,30,1>Input Gain (dB)
slider3:0<-12,0,1>Threshold (dB)
slider4:0<-30,12,1>Output Gain (dB)

in_pin:left input
in_pin:right input
out_pin:left output
out_pin:right output

@slider

mode   = slider1;
pre    = 2^(slider2/6);
center = 2^(slider3/6); // Origin of input vs. output waveshaping graph
post   = 2^(slider4/6);

@sample

//Pseudo tanh distortion, using continued fraction
mode == 0 ?
(
  spl0 *= pre;
  spl0 != center ?
  (
    sgn = abs(spl0-center);
  )
: (
    sgn = 1;
  );

  x     = (spl0/center);
  y     = sgn*max(spl0/center,center/spl0);
  
  spl0  = post*(y/(1+(y^2)/3));
  spl1  = spl0;
);
